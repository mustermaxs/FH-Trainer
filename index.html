<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="manifest" href="./manifest.webmanifest">

    <title>FH Training</title>
</head>
<body>

    <div id="appcontainer">
        <div id="opensidemenu">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <div class="sidemenu">
            <span id="closesidemenu">&#10006;</span>

            <div class="sidenavcontent" id="menu">
                <h3>Menu</h3>
            <a href="#quiz=sum">Summen schätzen</a>
            <a href="#quiz=percent">Prozente schätzen</a>
            <a href="#menu=settings">Einstellungen</a>
        </div>
            <div class="sidenavcontent" id="settings">
                <a href="#menu=menu" id="backToMainMenu">&#8592;</a>
                <h3>Menu</h3>
            <div class="settingswrapper">

                <div class="menusection">
                <label for="setTime">Zeit</label>
                <input min="0" max="20" data-target="settings"  type="range" name="time" id="setTime">
                <div class="rangedisplaywrapper">
                <span class="rangedisplay" id="time">12</span>
            </div>
            </div>

            </div>
        </div>
        </div>
        <div id="app">
        <div class="main">
            <div class="confirmwindow" id="startprompt">
                <span>Ready?</span>
                <button id="confirm">Start!</button>
            </div>
            <!-- <form> -->
                <!-- <span id="questionsremaining">5</span> -->
                <div class="timerWrapper">
                    <div id="timerfull"></div>
                </div>
            <div class="section" id="question">

                <span class="task" id="question">
                     ?
                </span>
            </div>
            <div class="section" id="answers">
                <span class="answerBox"></span>
                <span class="answerBox"></span>
                <span class="answerBox"></span>
                <span class="answerBox"></span>
                <span class="answerBox"></span>
            </div>
            <span style="color: darkgray; font-size: 0.7rem;">V 1.1</span>

        <!-- </form> -->
        </div>
    </div>
    </div>
</body>
<script src="./genQuestion.js"></script>
<script src="./settings.js"></script>
<script src="./estimatepercent.js"></script>
<script src="./ui/interface.js"></script>
<script src="./ui/sidenav.js"></script>
<script src="./ui/popup.js"></script>
<script>
    const eventtyp = eventType();
    var gameflow = new Controller();
    var timer = new Timer(gameflow);
    const sidemenu = SideNav();
    var openMenuBtn = document.querySelector("#opensidemenu");
    var closeMenuBtn = document.querySelector("#closesidemenu");
    openMenuBtn.addEventListener(eventtyp.click, sidemenu.toggle);
    closeMenuBtn.addEventListener(eventtyp.click, sidemenu.toggle);
    sidemenu.setContent("menu");
    sidemenu.render();
    const startwindow = Confirm({path: document.querySelector(".confirmwindow"), onConfirm: onConfirm})
    
    gameflow.quizShouldPause = false;
/* 
    function sidemenu() {
         var sidemenu = document.querySelector(".sidemenu");
         var sideMenuIsOpen = false;

         const opensidemenu = () => {
             sidemenu.classList.add("open");
             sideMenuIsOpen = true;
             gameflow.publish("stopQuiz");

         }
         const closesidemenu = () => {
             sidemenu.classList.remove("open");
             gameflow.quizShouldPause = false;
             sideMenuIsOpen = false;

         }
         return {
             toggle: () => {
                 sideMenuIsOpen ? closesidemenu() : opensidemenu()
             },
             close: () => {
                 closesidemenu()
             },
             open: () => {
                 opensidemenu()
             }
         }

    } */
    function onConfirm() {
        startwindow.hide();
        gameflow.quizShouldPause = false;
        startQuiz();
    }

    const log = console.log;

    
    var quizIF = new Quiz(gameflow);
    quizIF.setQuestionType("sum")
    quizIF.setDifficutly(1)

    var gameIteration
    
    // gameflow.register("newRound", sidemenu.close)
    gameflow.register("newRound", startQuiz)
    // gameflow.register("stopquiz", () => {gameflow.quizShouldPause = true})


    function startQuiz() {
        timer.reset();
        if (sidemenu.isOpen() || gameflow.quizShouldPause) {
            gameflow.quizShouldPause = true
            timer.reset();
            return
        }
        gameIteration = setTimeout(() => {
    quizIF.nextQuestion();
    quizIF.render();
    
    timer.start()
}, 2500);

    }

    function pauseQuiz() {
        gameflow.quizShouldPause = true;
    }

    (function handleHash() {
        // set initial hash-values on first page load
        window.location.hash = "#menu=menu";

        var previousQueries = {
            menu: "",
            quizType: "",
        };

        const getQueries = (hash) => {
                var queryTypePattern = /([a-z]+)=/
                var queryPattern = /=([a-z]+)/

                var queryType = hash.match(queryTypePattern);
                var query = hash.match(queryPattern);
                return {
                    ref: queryType[1],
                    query: query[1],
                }
            }
        const compareQueries = (queries) => {
            if (previousQueries.menu !== queries.menu) {
                previousQueries.menu = queries.menu;
                sidemenu.setContent(queries.menu);
            }
            if (previousQueries.quizType !== queries.quizType) {
                previousQueries.quizType = queries.quizType;
                quizIF.setQuestionType(queries.quizType);
                gameflow.publish("newRound");
            }
       }
       const reactToQuery = (queries) => {
                switch (queries.ref) {
                    case "menu":
                        sidemenu.setContent(queries.query);

                        break;
                    case "quiz":
                        quizIF.setQuestionType(queries.query);
                        startwindow.show();
                        sidemenu.close();
                        
                        // quizIF.render()
                        // gameflow.publish("newRound")

                        break;
                    default:
                        break;
                }
            }
       const replaceHash = (queries) => {
        var newHashValueForURL = `#menu=${queries.menu}&quiz=${queries.quizType}`;
        window.location.hash = newHashValueForURL;
       }
        window.addEventListener("hashchange", (ev) => {
            ev.preventDefault();
            var hashValue = location.hash.split("#")[1];
            var queries = getQueries(hashValue);
            // compareQueries(queries)
            reactToQuery(queries)
            // replaceHash(queries);
        });

    })()



    
    </script>
    <!-- <script src="./registersw.js" defer></script> -->
</html>